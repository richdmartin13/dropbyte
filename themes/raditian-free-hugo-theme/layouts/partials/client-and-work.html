{{ if .Site.Data.homepage.client_and_work.enable }}
<section id="portfolio" class="section section--border-bottom">
  <div class="container">
    <h2 class=" rad-animation-group rad-fade-down">
      {{ .Site.Data.homepage.client_and_work.title }}
    </h2>
    <div class="row row--padded rad-animation-group rad-fade-down">
      <div class="col-12">
        <div class="clients">
          {{ range .Site.Data.homepage.client_and_work.clients }}
          <div class="clients__item">
            <a href="https://radity.com">
              <img
                class="lozad img-responsive"
                src="data:image/gif;base64,R0lGODlhBwACAIAAAP///wAAACH5BAEAAAEALAAAAAAHAAIAAAIDjI9YADs="
                data-src="{{ .logo.x | absURL }}"
                data-srcset="{{ .logo.x | absURL }} 1x, {{ .logo._2x | absURL }} 2x"
                alt="{{ .alt }}"
              />
            </a>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
    {{ range $index, $element := .Site.Data.homepage.client_and_work.works }}
    <div
      class="row row--padded rad-animation-group rad-fade-down {{ if .is_even }}flex-column-reverse flex-md-row{{ end }}"
    >
      {{ if .is_even }}
      <div class="col-12 col-md-5 mt-4 mt-md-0 my-md-auto">
        <h3>{{ .title }}</h3>
        <p class="lead">
          {{ .description }}
        </p>
        <!--Search-->
        {{ if .has_search }}
        <form method="get" action="">
          <input id="search" name="q" type="text" />
          <button type="submit" class="button">Search</button>
          <a href="/search">Clear</a>
        </form>
        <div id="#app"></div>
        
        <script src="https://unpkg.com/lunr/lunr.js"></script>
        <!-- Generate a list of posts so we can display them -->
        {{ $p := slice }}
        {{ range (.Site.RegularPages) }}
          {{ $post := dict "link" .RelPermalink "title" .Title "content" (substr .Plain 0 200) -}}
          {{ $p = $p | append $post -}}
        {{ end }}
        <script>
        const posts = JSON.parse(
          {{ $p | jsonify }}
        );
        
        const query = new URLSearchParams(window.location.search);
        const searchString = query.get('q');
        document.querySelector('#search').value = searchString;
        const $target = document.querySelector('#app');
        
        // Our index uses title as a reference
        const postsByTitle = posts.reduce((acc, curr) => {
          acc[curr.title] = curr;
          return acc;
        }, {});
        
        fetch('/gen/search-index.json').then(function (res) {
          return res.json();
        }).then(function (data) {
          const index = lunr.Index.load(data);
          const matches = index.search(searchString);
          const matchPosts = [];
          matches.forEach((m) => {
            matchPosts.push(postsByTitle[m.ref]);
          });
        
          if (matchPosts.length > 0) {
            $target.innerHTML = matchPosts.map(p => {
              return `<div>
                <h3><a href="${p.link}">${p.title}</a></h3>
                <p>${p.content}...</p>
              </div>`;
            }).join('');
          } else {
            $target.innerHTML = `<div>No search results found</div>`;
          }
        });
      </script>
        <!--End search-->
        {{ else }}
        <a href="{{ .button.URL | absURL }}" class="btn btn-primary"
          ><ion-icon name="{{ .button.icon }}"></ion-icon>&nbsp;{{ .button.btnText }}</a>
        {{ end }}
      </div>
      <div class="col-12 col-md-7 pl-md-0 text-right">
        <img
          class='lozad img-responsive {{ cond (eq ( mod $index 4) 0) "img-clip-left-backward" "img-clip-left-forward" }}'
          src="data:image/gif;base64,R0lGODlhBwACAIAAAP///wAAACH5BAEAAAEALAAAAAAHAAIAAAIDjI9YADs="
          data-src="{{ .image.x | absURL }}"
          data-srcset="{{ .image.x | absURL }} 1x, {{ .image._2x | absURL }} 2x"
          alt="{{ .title }}"
        />
      </div>
      {{ else }}
      <div class="col-12 col-md-7 pl-md-0 text-right">
        <img
          class='lozad img-responsive {{ cond (eq ( mod $index 4) 1)  "img-clip-right-backward" "img-clip-right-forward" }}'
          src="data:image/gif;base64,R0lGODlhBwACAIAAAP///wAAACH5BAEAAAEALAAAAAAHAAIAAAIDjI9YADs="
          data-src="{{ .image.x | absURL }}"
          data-srcset="{{ .image.x | absURL }} 1x, {{ .image._2x | absURL }} 2x"
          alt="{{ .title }}"
        />
      </div>
      <div class="col-12 col-md-5 mt-4 mt-md-0 my-md-auto">
        <h3>{{ .title }}</h3>
        <p class="lead">
          {{ .description }}
        </p>
        <a href="{{ .button2.URL | absURL }}" class="btn btn-primary"
        ><ion-icon name="{{ .button2.icon }}"></ion-icon>&nbsp;{{ .button2.btnText }}</a>
        <a href="{{ .button.URL | absURL }}" class="btn btn-frameless"
          ><ion-icon name="{{ .button.icon }}"></ion-icon>&nbsp;{{ .button.btnText }}</a>
      </div>
      {{ end }}
    </div>
    {{ end }}
  </div>
</section>
{{ end }}
